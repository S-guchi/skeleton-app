
# 目的

- 既存 Expo アプリを「読みやすく・壊れにくく・速い」コードへ刷新する
- Expo SDK 53 / React Native 0.79 / React 19 に完全準拠
- 機能は変えず、全テストを通したまま品質を高める

######################## 1. プロジェクト・メタデータ ########################
<PROJECT_NAME>   : usako-work
<TYPESCRIPT?>    : true
###########################################################################

######################## 2. リファクタリング目標 ###########################

## 2-A. コード品質

1. SOLID & React 慣例に沿った責務分離
2. Hooks / Context の整理で再描画削減
3. 無名関数・インラインスタイル・魔法値撲滅
4. ESLint + Prettier による自動整形

## 2-B. テスト

- **ユニット**: Jest で実コードのみ import（ロジック複製禁止）
- **E2E**   : Maestro でユーザーフローを担保
  → GitHub Actions / EAS で両テスト並列実行

######################## 3. TDD Guidelines (T-wada式) ######################
A. 5 ステップ “TODOリスト TDD ループ”

   1) TODOリストへ振る舞いを列挙
   2) 失敗するテストを書く (Red)
   3) 最短で通す実装を書く (Green)
   4) 重複と匂いを除去 (Refactor)
   5) リストが空になるまで繰り返し

B. ベイビーステップ ― 1 周期 ≤ 5 分・小コミット
C. Triangulation ― 複数テストが通ったら実装一般化
D. 良いテストの尺度 ― 読みやすい／意図がわかる／壊れにくい
E. ツール ― Jest `--watch`、Maestro で UI シナリオを文書化
###########################################################################

######################## 4. 出力フォーマット (AI の応答) ####################

````md
## Summary
- <ねらいと効果を 3 行以内>

## Fix Plan
1. <課題と解決策>
   - **Breaking-change**: true/false
   - **Risk**: <簡潔に>
2. ...

## Diff (unified patch)
```diff
<主要 3 ファイルまで簡潔に>
````

## TODO

- [ ] <残タスク> @owner

```
###########################################################################

######################## 5. 制約・ルール ###################################
- **TDD First**: Red → Green → Refactor を厳守。
- ビジネスロジックの再実装は禁止、既存コードを呼び出すこと。
###########################################################################

######################## 6. AI 内部ワークフロー ############################
0. **TDD TODOリスト** 自動生成 → セクション 3-A のループを開始
1. 静的解析 (AST / ESLint / ts-server) で依存グラフ取得
2. Expo 53 互換ライブラリチェック・未対応は代替提案
3. rename → extract → reuse → dead-code 削除の順に最小単位でリファクタ
4. ベンチマーク: FPS・bundle size Before/After を計測
5. テスト & CI を全緑にし、リグレッション確認
6. Summary に成果を集約し終了
###########################################################################
